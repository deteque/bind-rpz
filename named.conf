# ------------------------------------------------------------------------------------------
# MASTERS
# ------------------------------------------------------------------------------------------

masters DISTRIBUTION-SERVERS {
};

# ------------------------------------------------------------------------------------------
# ACLs
# ------------------------------------------------------------------------------------------

acl LOCAL {
	::1;
	127.0.0.0/8;
	10.0.0.0/8;
	172.16.0.0/12;
	192.168.0.0/16;
};

# ------------------------------------------------------------------------------------------
# RNDC key generated by "/usr/sbin/rndc-confgen"
# ------------------------------------------------------------------------------------------

key "rndc-key" {
        algorithm hmac-sha256;
        secret "aBUOt4cFNES7mmpMIEU/5BN5wqFfVeL/Z7itjlb4jjc=";
};

# ------------------------------------------------------------------------------------------
# LOGGING Configuration
# ------------------------------------------------------------------------------------------

logging {
        channel null { 
		null; 
	};

        channel default_stderr { 
		stderr; 
		severity info; 
	};

        channel default_syslog { 
		syslog daemon; 
		severity info; 
	};

        channel default_debug { 
		file "named.run";  
		severity dynamic; 
	};

        channel bindlog { 
		file "bind.log"; 
		print-time yes; 
		print-category yes; 
		print-severity yes; 
		severity info; 
	};

	channel query-errorlog {
		file "query-errors.log";
		print-time yes;
		print-category yes;
		print-severity yes;
		severity info;
	};

        channel rpzlog {
                file "rpz.log" versions unlimited size 1000m;
                print-time yes;
                print-category yes;
                print-severity yes;
                severity info;
        };

        category default { bindlog; };
        category general { bindlog; };
        category database { null; };
        category config { bindlog; };
        category resolver { null; };
        category xfer-in { bindlog; };
        category xfer-out { bindlog; };
        category notify { bindlog; };
        category client { null; };
        category unmatched { null; };
        category network { bindlog; default_syslog; };
        category update { bindlog; };
        category update-security { bindlog; };
        category queries { null; };
        category dispatch { null; };
        category lame-servers { null; };
        category delegation-only { bindlog; };
        category edns-disabled { null; };
        category rpz { rpzlog; };
        category query-errors { query-errorlog; };
};

controls {
	inet 127.0.0.1 port 953
	allow { 127.0.0.1; } keys { rndc-key; };
};

options {
	directory "/etc/namedb";
	key-directory "/etc/namedb";
	pid-file "/var/run/named.pid";
	recursing-file "named.recursing";
	statistics-file "rndc.stats";
	notify no;
	recursion yes;
	zone-statistics yes;
	check-mx warn;
	check-integrity yes;
	try-tcp-refresh yes;
	recursive-clients 1000;
        transfers-in 50;
        transfers-out 75;
        transfers-per-ns 50;
        serial-query-rate 50;
        min-refresh-time 60;
        max-refresh-time 3600;
        tcp-listen-queue 250;
	tcp-clients 100;
	interface-interval 60;
	lame-ttl 300;
	masterfile-format text;
	max-ncache-ttl 600;
	max-recursion-queries 100000;
	max-recursion-depth 12;
	allow-transfer { none; };
	ixfr-from-differences yes;
	empty-zones-enable yes;
	send-cookie no;
	allow-recursion  { LOCAL; };
	allow-query-cache { LOCAL; };
        response-policy {
                zone "bogons.ip.dtq";
                zone "dga.host.dtq";
		zone "malware.domains.dtq";
                zone "malware.hacked.host.dtq";
                zone "malware.host.dtq";
                zone "botnetcc.ip.dtq";
                zone "botnetcc.host.dtq";
                zone "botnet.host.dtq";
                zone "phish.host.dtq";
                zone "badrep.host.dtq";
                zone "bad-nameservers.ip.dtq";
                zone "bad-nameservers.host.dtq";
                zone "coinblocker.srv";
                zone "torblock.srv";
                zone "adware.edit.host.dtq";
                zone "drop.ip.dtq";
        };
};

#------------------------------------------------------------------------------
# Root cache
#------------------------------------------------------------------------------

zone "." {
	type hint;
	file "root.cache";
};

#------------------------------------------------------------------------------
# Deteque Abused Legit RPZ Zones
#	- botnetcc.hacked.host.dtq
#	- botnetcc.hacked.ip.dtq
#	- malware.hacked.host.dtq
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# Deteque Botnet RPZ Zones
#	- botnetcc.edit.host.dtq
#	- botnetcc.hacked.host.dtq
#	- botnetcc.hacked.ip.dtq
#	- botnetcc.host.dtq
#	- botnetcc.ip.dtq
#	- botnet.edit.host.dtq
#	- botnet.host.dtq
#	- dga.host.dtq
#------------------------------------------------------------------------------

zone "botnetcc.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.botnetcc.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "botnetcc.ip.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.botnetcc.ip.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "botnet.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.botnet.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "dga.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.dga.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

#------------------------------------------------------------------------------
# Deteque Malware RPZ Zones
#	- malware.domains.dtq
#	- malware.edit.host.dtq
#	- malware.hacked.host.dtq
#	- malware.host.dtq
#------------------------------------------------------------------------------

zone "malware.domains.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.malware.domains.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "malware.hacked.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.malware.hacked.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "malware.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.malware.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

#------------------------------------------------------------------------------
# Deteque Bad Reputation RPZ Zones
#	- adware.edit.host.dtq
#	- adware.host.dtq
#	- bad-nameservers.host.dtq
#	- bad-nameservers.ip.dtq
#	- badrep.edit.host.dtq
#	- badrep.hacked.host.dtq
#	- badrep.host.dtq
#	- bogons.ip.dtq
#	- drop.ip.dtq
#------------------------------------------------------------------------------

zone "adware.edit.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.adware.edit.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "bad-nameservers.ip.dtq" {
	type slave;
	masters { DISTRIBUTION-SERVERS; };
	file "/etc/namedb/zonefiles/dbx.bad-nameservers.ip.dtq";
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "bad-nameservers.host.dtq" {
	type slave;
	masters { DISTRIBUTION-SERVERS; };
	file "/etc/namedb/zonefiles/dbx.bad-nameservers.host.dtq";
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "badrep.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.badrep.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "bogons.ip.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.bogons.ip.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

zone "drop.ip.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.drop.ip.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

#------------------------------------------------------------------------------
# Deteque Phishing RPZ Zones
#	- phish.edit.host.dtq
#	- phish.hacked.host.dtq
#	- phish.host.dtq
#------------------------------------------------------------------------------

zone "phish.host.dtq" {
	type slave;
	file "/etc/namedb/zonefiles/dbx.phish.host.dtq";
	masters { DISTRIBUTION-SERVERS; };
	allow-query { localhost; };
	allow-transfer { none; };
};

#------------------------------------------------------------------------------
# Deteque Third Party RPZ Zones
#	- coinblocker.srv
#	- porn.host.srv
#	- torblock.srv
#------------------------------------------------------------------------------

zone "coinblocker.srv" {
        type slave;
        file "/etc/namedb/zonefiles/dbx.coinblocker.srv";
        masters { DISTRIBUTION-SERVERS; };
        allow-query { localhost; };
        allow-transfer { none; };
};

zone "torblock.srv" {
        type slave;
        file "/etc/namedb/zonefiles/dbx.torblock.srv";
        masters { DISTRIBUTION-SERVERS; };
        allow-query { localhost; };
        allow-transfer { none; };
};

#------------------------------------------------------------------------------
# Deteque Special Use Zones - Designed to disable the use of DoH DNS
#	- doh.dtq 
#------------------------------------------------------------------------------

zone "doh.dtq" {
        type slave;
        file "/etc/namedb/zonefiles/dbx.doh.dtq";
        masters { DISTRIBUTION-SERVERS; };
        allow-query { localhost; };
        allow-transfer { none; };
};
